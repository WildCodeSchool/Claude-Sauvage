{% extends "GedBundle::layout.html.twig" %}
{% block body %}
{% include "GedBundle::nav.html.twig" %}
{% include "GedBundle::search.html.twig" %}
<div class="col-md-10">
{# 	page d'affichage du dashboard #}
	{# flashbags  #}
	{% if nbBrouillon != 0 %}
		<div class="alert alert-success alert-dismissible navbar-header pagination-centered col-md-10 col-md-offset-1" role="alert">
			<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			{% for flashMessage in app.session.flashbag.get('success') %}
		        <strong>Succes </strong>{{ flashMessage }}
			    {% if file is defined %}
			        <p><a href="{{ path('ged_parameters_file', { 'id' : file }) }}" title="">Vous pouvez maintenant regler les parametres du document ici.</a></p>
			    {% endif %}
			    <br />
			{% endfor %}
			{% if nbBrouillon == 1 %}
				<p><a href="{{ path('ged_parameters_list') }}" title="">Vous avez actuellement {{ nbBrouillon }} fichier, à définir.</a></p>
			{% else %}
				<p><a href="{{ path('ged_parameters_list') }}" title="">Vous avez actuellement {{ nbBrouillon }} fichiers, à définir.</a></p>
			{% endif %}
		</div>
	{% else %}
		{% for flashMessage in app.session.flashbag.get('success') %}
			<div class="alert alert-success alert-dismissible navbar-header pagination-centered col-md-10 col-md-offset-1" role="alert">
				<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	       		 <strong>Succes </strong>{{ flashMessage }}
		    	{% if file is defined %}
		    		<p><a href="{{ path('ged_parameters_file', { 'id' : file }) }}" title="">Vous pouvez maintenant régler les parametres du document ici.</a></p>
		    	{% endif %}
			</div>
		{% endfor %}	
	{% endif %}

{# 	debut des 4 tables de fichiers #}
	{# tableau des favoris #}
	<div class="col-md-6 tab-cel ">
		<h3 style="text-align:center;">Mes favoris</h3>
		<table class="table compact stripe" id="table">
			<thead> 
				<tr> 
					<th></th> 
					<th>Nom du fichier</th>
					<th>Catégorie</th> 
					<th>Tags</th>
					<th>Paramètres</th>
				</tr> 
			</thead> 
			<tbody>
				{% if tabfav is defined %}
					{% for favorite in tabfav %}
						<tr> 
							<td>
								{% if favorite['type'] == 'jpeg' or favorite['type'] == 'jpg' or favorite['type'] == 'png' or myfiles['type'] == 'gif' %}
									<span class="glyphicon glyphicon-picture" aria-hidden="true"></span>
								{% elseif favorite['type'] == 'txt' or favorite['type'] == 'doc' %}
									<span class="glyphicon glyphicon-file" aria-hidden="true"></span>
								{% elseif favorite['type'] == 'mp4' or favorite['type'] == 'avi' %}
									<span class="glyphicon glyphicon-film" aria-hidden="true"></span>
								{% elseif favorite['type'] == 'mp3' or favorite['type'] == 'wave' %}
									<span class=" glyphicon glyphicon-music" aria-hidden="true"></span>
								{% else %}
									Ico
								{% endif %}
							</td>
							<td><a href="{{ path('one_file' , {'id': favorite['idfile'] }) }}">{{ favorite['name'] }}</a></td>
							<td>{{ favorite['category'] }}</td> 
							<td>
								{% for tag in favorite['tagnames'] %}
									{{ tag['name'] }} ,
								{% endfor %}
							</td>
							<td>
								{% if favorite['idowner'] == user.id %}
									<a class="btn" href="{{ path('ged_parameters_file', { 'id' : favorite['idfile'] }) }}" title="">
									<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
								{% else %}
									<span class="glyphicon glyphicon-ban-circle btn disabled" aria-hidden="true"></span>
								{% endif %}
							</td>
							<td>{{ favorite['date'].date }}</td>
						</tr>
					{% endfor %}
				{% endif %}
			</tbody>
		</table>
	</div>
	{# tableau des uploads #}
	<div class="col-md-6 tab-cel">
		<h3 style="text-align:center;">Mes uploads</h3>
		<table class="table compact stripe  tab-cel" id="table">
			<thead> 
				<tr> 
					<th></th> 
					<th>Nom du fichier</th>
					<th>Catégorie</th> 
					<th>Tags</th>
					<th>Paramètres</th>
				</tr> 
			</thead> 
			<tbody>
				{% if tabupl is defined %}
					{% for upload in tabupl %}
						<tr> 
							<td>
								{% if upload['type'] == 'jpeg' or upload['type'] == 'jpg' or upload['type'] == 'png' or upload['type'] == 'gif' %}
									<span class="glyphicon glyphicon-picture" aria-hidden="true"></span>
								{% elseif upload['type'] == 'txt' or upload['type'] == 'doc' %}
									<span class="glyphicon glyphicon-file" aria-hidden="true"></span>
								{% elseif upload['type'] == 'mp4' or upload['type'] == 'avi' %}
									<span class="glyphicon glyphicon-film" aria-hidden="true"></span>
								{% elseif upload['type'] == 'mp3' or upload['type'] == 'wave' %}
									<span class=" glyphicon glyphicon-music" aria-hidden="true"></span>
								{% else %}
									Ico
								{% endif %}
							</td> 
								<td><a href="{{ path('one_file' , {'id': upload['idfile'] }) }}">{{ upload['name'] }}</a></td>
							<td>{{ upload['category'] }}</td> 
							<td>
								{% for tag in upload['tagnames'] %}
									{{ tag['name'] }}
								{% endfor %}
							</td>
							<td>
								{% if upload['idowner'] == user.id %}
									<a class="btn" href="{{ path('ged_parameters_file', { 'id' : upload['idfile'] }) }}" title="">
									<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
								{% else %}
									<span class="glyphicon glyphicon-ban-circle btn disabled" aria-hidden="true"></span>
								{% endif %}
							</td>
							<td>{{ upload['date'].date }}</td>
						</tr>
					{% endfor %}
				{% endif %}
			</tbody>
		</table>
	</div>
</div>
<div class="col-md-10">
	{# tableau des derniers commentés #}
	<div class="col-md-6 tab-cel">
		<h3 style="text-align:center;">Derniers commentés</h3>
		<table class="table compact stripe" id="tablecom">
			<thead> 
				<tr> 
					<th></th> 
					<th>Nom du fichier</th>
					<th>Catégorie</th> 
					<th>Tags</th>
					<th>Paramètres</th>
				</tr> 
			</thead> 
			<tbody>
				{% if tabcom is defined %}
					{% for commented in tabcom %}
						<tr>
							<td>
								{% if commented['type'] == 'jpeg' or commented['type'] == 'jpg' or commented['type'] == 'png' or myfiles['type'] == 'gif' %}
									<span class="glyphicon glyphicon-picture" aria-hidden="true"></span>
								{% elseif commented['type'] == 'txt' or commented['type'] == 'doc' %}
									<span class="glyphicon glyphicon-file" aria-hidden="true"></span>
								{% elseif commented['type'] == 'mp4' or commented['type'] == 'avi' %}
									<span class="glyphicon glyphicon-film" aria-hidden="true"></span>
								{% elseif commented['type'] == 'mp3' or commented['type'] == 'wave' %}
									<span class=" glyphicon glyphicon-music" aria-hidden="true"></span>
								{% else %}
									Ico
								{% endif %}
							</td> 
							<td><a href="{{ path('one_file' , {'id': commented['idfile'] }) }}">{{ commented['name'] }}</a></td>
							<td>{{ commented['category'] }}</td> 
							<td>
								{% for tag in commented['tagnames'] %}
									{{ tag['name'] }} ,
								{% endfor %}
							</td>
							<td>
								{% if commented['idowner'] == user.id %}
									<a class="btn" href="{{ path('ged_parameters_file', { 'id' : commented['idfile'] }) }}" title="">
									<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
								{% else %}
									<span class="glyphicon glyphicon-ban-circle btn disabled" aria-hidden="true"></span>
								{% endif %}
							</td>
							<td>{{ commented['date'].date }}</td>
						</tr>
					{% endfor %}
				{% endif %}
			</tbody>
		</table>
	</div>
	{# tableau des fichiers partagés avec moi #}
	<div class="col-md-6 tab-cel">
		<h3 style="text-align:center;">Partagés avec moi</h3>
		<table class="table compact stripe" id="table">
			<thead> 
				<tr> 
					<th></th> 
					<th>Nom du fichier</th>
					<th>Catégorie</th> 
					<th>Tags</th>
					<th>Paramètres</th>
				</tr> 
			</thead> 
			<tbody>
				{% if tabpart is defined %}
					{% for partaged in tabpart %}
						<tr>
							<td>
								{% if partaged['type'] == 'jpeg' or partaged['type'] == 'jpg' or partaged['type'] == 'png' or partaged['type'] == 'gif' %}
									<span class="glyphicon glyphicon-picture" aria-hidden="true"></span>
								{% elseif partaged['type'] == 'txt' or partaged['type'] == 'doc' %}
									<span class="glyphicon glyphicon-file" aria-hidden="true"></span>
								{% elseif partaged['type'] == 'mp4' or partaged['type'] == 'avi' %}
									<span class="glyphicon glyphicon-film" aria-hidden="true"></span>
								{% elseif partaged['type'] == 'mp3' or partaged['type'] == 'wave' %}
									<span class=" glyphicon glyphicon-music" aria-hidden="true"></span>
								{% else %}
									Ico
								{% endif %}
							</td>
							<td><a href="{{ path('one_file' , {'id': partaged['idfile'] }) }}">{{ partaged['name'] }}</a></td>
							<td>{{ partaged['category'] }}</td> 
							<td>
								{% for tag in partaged['tagnames'] %}
									{{ tag['name'] }} ,
								{% endfor %}
							</td>
							<td>
								{% if partaged['idowner'] == user.id %}
									<a class="btn" href="{{ path('ged_parameters_file', { 'id' : partaged['idfile'] }) }}" title="">
									<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
								{% else %}
									<span class="glyphicon glyphicon-ban-circle btn disabled" aria-hidden="true"></span>
								{% endif %}
							</td>
							<td>{{ partaged['date'].date }}</td>
						</tr>
					{% endfor %}
				{% endif %}
			</tbody>
		</table>
	</div>
</div>
<script type="text/javascript"> 
// script datatables pour le tri par date et champ date caché
$(document).ready(function() { 
	$('table').DataTable( { 
		"paging": false,
		"info": false,
		"sDom": '<"H"lr>t<"F"ip>',
		"columnDefs": [
			{ 
				"orderable": false,
				"targets": [3,4]
			},
			{
                "targets": [ 5 ],
                "visible": false,
                "searchable": false
            },],
		"order": [[5, "asc"]]
	} );
	$('tablecom').DataTable( { 
		"paging": false,
		"info": false,
		"sDom": '<"H"lr>t<"F"ip>',
		"columnDefs": [
			{ 
				"orderable": false,
				"targets": [3,4]
			},
			{
                "targets": [ 5 ],
                "visible": false,
                "searchable": false
            },],
		"order": [[5, "desc"]]
	} );
} );
</script>
{% endblock body %}